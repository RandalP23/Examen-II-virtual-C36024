---
title: "Examen_II_G1"
author: "RandalPicadoBermudezC36024"
format: pdf
editor: visual
date: "11-30-2025"
toc: true
theme: cosmo
self-contained: true
---
Grupo 1: Luis Alberto Juárez Potoy

#Parte1
```{r}
library(tidyverse)
library(scales)
library(readxl)
moras <- read_excel("moras.xlsx")

```

#Parte2
```{r}
resumen <- moras %>%
  summarise(
    media.edad = mean(EDAD, na.rm = TRUE),
    minimo.edad = min(EDAD, na.rm = TRUE),
    maximo.edad = max(EDAD, na.rm = TRUE),
    q1.edad = quantile(EDAD, 0.25, na.rm = TRUE),
    q3.edad = quantile(EDAD, 0.75, na.rm = TRUE),
    
    media.salario = mean(SALARIO, na.rm = TRUE),
    minimo.salario = min(SALARIO, na.rm = TRUE),
    maximo.salario = max(SALARIO, na.rm = TRUE),
    q1.salario = quantile(SALARIO, 0.25, na.rm = TRUE),
    q3.salario = quantile(SALARIO, 0.75, na.rm = TRUE),
      )

resumen
```

#Parte3
```{r}
mean.salario <- mean(moras$SALARIO, na.rm = TRUE)
mean.edad <- mean(moras$EDAD, na.rm = TRUE)
desviacion.salario <- sd(moras$SALARIO, na.rm = TRUE)
desviacion.edad <- sd(moras$EDAD, na.rm = TRUE)

moras <- moras %>% 
  mutate(
    Z.SALARIO = (SALARIO - mean.salario) / desviacion.salario,
    Z.EDAD = (EDAD - mean.edad) / desviacion.edad
    ) %>% 
  mutate(
    ATIPICO.SALARIO = if_else(abs(Z.SALARIO) > 1.96, "ATIPICO", "NO ATIPICO"),
    ATIPICO.EDAD = if_else(abs(Z.EDAD) > 1.96, "ATIPICO", "NO ATIPICO")
  )

```

#Parte4
```{r}
porcentajes.na <- data.frame(
  dato = names(moras),
  faltante = colSums(is.na(moras))
) %>% 
  mutate(
    porcentajes.na = (faltante/5000)* 100
  )
```

#Parte5
```{r}
#Los unicos con valores atipicos son Salario, tipo Aseguramiento y edad, con 3,2 y 3 valores respectivamente, lo cual no es significativo dentro del total (5000), por lo tanto por eficiencia se va a imputar con media y con moda.

moda.aseguramiento <- moras %>% 
  group_by(TIPO_ASEGURAMIENTO) %>% 
  summarise( contador = n()) %>% 
  arrange(desc(contador)) %>% 
  head(1)

moda.aseg <- moda.aseguramiento$TIPO_ASEGURAMIENTO

moras <- moras %>% 
  mutate(
    EDAD = if_else(is.na(EDAD), mean.edad, EDAD),
    SALARIO = if_else(is.na(SALARIO), mean.salario, SALARIO),
    TIPO_ASEGURAMIENTO = if_else(is.na(TIPO_ASEGURAMIENTO), moda.aseg, TIPO_ASEGURAMIENTO)
  )
```

#Parte6
```{r}

graf.cantidadporsexo <- moras %>% 
  group_by(SEXO) %>% 
  summarise(contador = n()) %>% 
  ggplot(aes(x = SEXO, y = contador)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Cantidad por sexo", x = "Sexo", y = "Cantidad")+
  theme_minimal()

graf.cantidadporsexo

graf.cantidadporaseguramiento <- moras %>% 
  group_by(TIPO_ASEGURAMIENTO) %>% 
  summarise(contador = n()) %>% 
  ggplot(aes(x = TIPO_ASEGURAMIENTO, y = contador)) +
  coord_flip()+
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Cantidad por aseguramiento", x = "Aseguramiento", y = "Cantidad")+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 25, hjust = 1))

graf.cantidadporaseguramiento

graf.cantidadporsector <- moras %>% 
  group_by(SECTOR) %>% 
  summarise(contador = n()) %>% 
  ggplot(aes(x = SECTOR, y = contador)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Cantidad por sector", x = "Sector", y = "Cantidad")+
  theme_minimal()

graf.cantidadporsector

graf.cantidadporextranjeros<- moras %>% 
  group_by(INDICADOR.EXTRANJERO) %>% 
  summarise(contador = n()) %>% 
  ggplot(aes(x = INDICADOR.EXTRANJERO, y = contador)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Cantidad por extranjeros", x = "Extranjero", y = "Cantidad")+
  theme_minimal()

graf.cantidadporsector

graf.cantidadporactividad <- moras %>% 
  group_by(INDICADOR_ACTIVO) %>% 
  summarise(contador = n()) %>% 
  ggplot(aes(x = INDICADOR_ACTIVO, y = contador)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Cantidad por actividad", x = "Activo", y = "Cantidad")+
  theme_minimal()

graf.cantidadporactividad

graf.cantidadpormorosidad <- moras %>% 
  group_by(INDICADOR_MOROSO) %>% 
  summarise(contador = n()) %>% 
  ggplot(aes(x = INDICADOR_MOROSO, y = contador)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Cantidad por morosidad", x = "Moroso", y = "Cantidad")+
  theme_minimal()

graf.cantidadpormorosidad

##La interpretacion de estas graficas es analoga al de excel, pues son los mismos graficos.

```

#parte7
```{r}
graf.porcentajemorosidad <- function(data, categoria){
  
  datos <- data %>% 
    group_by(.data[[categoria]]) %>% 
    summarise(
      cantidad   = n(),
      morosos    = sum(INDICADOR_MOROSO == "SI"),
      porcentaje = morosos / cantidad
    )
  
  ggplot(datos, aes(x = .data[[categoria]], y = porcentaje)) +
    geom_col(fill = "steelblue") +
    geom_text(aes(label = percent(porcentaje, accuracy = 0.1)),
              vjust = -0.5, size = 4) +
    scale_y_continuous(labels = percent_format(accuracy = 1),
                       limits = c(0, max(datos$porcentaje) * 1.15)) +
    labs( title = paste("% de morosos por", categoria), x = categoria,y = "Porcentaje"
    ) +
    theme_minimal()
}

graf.porcentajemorosidad(moras, "SEXO")

#Note que aunque hay diferencia es minima, no es ni un 1% la diferencia entre el porcentaje de hombres y mujeres morosas, lo indica que esta categoria no da mucha informacion para decidir si una persona va a ser morosa por su SEXO

graf.porcentajemorosidad(moras, "INDICADOR_ACTIVO")

#Note que aquí la diferencia es bastante, las personas no activan son mucho mas morosas que las activas, lo cual tiene un poco de sentido, pues es de esperar que las personas activas tiendan a cumplir mas con los cumplimientos

graf.porcentajemorosidad(moras, "INDICADOR.EXTRANJERO")

#Este grafico nos muestra como las personas extranjeras tienden a ser mas morosas que las no extranjeras, las razones de esto pueden ser varias, como la estabilidad laboral, pues en muchas ocaciones los extranjeros no tienen salario o empleo fijo (en los locales tambien se da pero menos)

graf.porcentajemorosidad(moras, "SECTOR")

#El sector privado tiene una mayor cantidad de morosos (18%), lo cual se puede deber a que las personas en el sector publico suelen ser tener mejores salarios y mejor estabilidad lo cual lo llevan a cumplir mas con sus pagos.


distribucion.aseg <- moras %>% 
  group_by(TIPO_ASEGURAMIENTO) %>% 
  summarise(
    cantidad = n(),
    morosos = sum(INDICADOR_MOROSO == "SI"),
    porcentaje = morosos / cantidad
  )

ggplot(distribucion.aseg, aes(x = porcentaje, y = TIPO_ASEGURAMIENTO)) +
  geom_col(fill = "steelblue") +
  geom_text(aes(label = percent(porcentaje, accuracy = 0.1)),
            hjust = -0.1, size = 4) +
  scale_x_continuous(labels = percent_format(accuracy = 1),
                     limits = c(0, max(distribucion.aseg$porcentaje) * 1.15)) +
  labs(title = "% de morosos por tipo de aseguramiento",x = "Porcentaje",y = "Tipo de aseguramiento"
  ) +
  theme_minimal()

#Note que el trabajadores independientes es extremadamente alto (56%) lo cual se puede deber a varias razones, como a que esta población el salario que perciben suele variar mucho dependiendo las fechas del año y diversos factores, lo cual puede llevar a que muchas veces no puedan realizar los pagos.

```

